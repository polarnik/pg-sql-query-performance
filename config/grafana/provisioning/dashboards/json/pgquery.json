{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"slug":"postgresql-query-details","url":"/d/pgquery/postgresql-query-details","expires":"0001-01-01T00:00:00Z","created":"2021-05-24T22:02:42Z","updated":"2021-05-25T18:43:42Z","updatedBy":"Anonymous","createdBy":"Anonymous","version":16,"hasAcl":false,"isFolder":false,"folderId":0,"folderTitle":"General","folderUrl":"","provisioned":false,"provisionedExternalId":"pgquery.json"},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":"$db_jmeter","enable":false,"hide":false,"iconColor":"#37872D","limit":100,"name":"(start)","query":"select text,generatorHost,application,title FROM (select text from events where $timeFilter and \"text\" =~ /.*started$/ GROUP BY generatorHost,application,title)","showIn":0,"tags":[],"tagsColumn":"generatorHost,application,title","textColumn":"text","type":"tags"},{"datasource":"$db_jmeter","enable":false,"hide":false,"iconColor":"#1F60C4","name":"(stop)","query":"select \"text\", \"generatorHost\", \"application\" FROM (select text from events where $timeFilter and \"text\" =~ /.*ended$/ GROUP BY  \"generatorHost\", \"application\")","showIn":0,"tagsColumn":"application,generatorHost","textColumn":"text"}]},"editable":true,"gnetId":null,"graphTooltip":1,"id":5,"iteration":1621966399478,"links":[],"panels":[{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":41,"panels":[],"title":"Сводная статистика по QueryID = ${queryid}","type":"row"},{"datasource":"$db","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false,"width":100},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"usename"},"properties":[{"id":"custom.width","value":326}]},{"matcher":{"id":"byName","options":"Total"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":3,"w":23,"x":0,"y":1},"id":37,"links":[],"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"","targets":[{"groupBy":[{"params":["host"],"type":"tag"},{"params":["datname"],"type":"tag"},{"params":["usename"],"type":"tag"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","query":"","rawQuery":false,"refId":"A","resultFormat":"table","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Calls"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Total"],"type":"alias"}],[{"params":["rows_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Rows"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / sum(\"calls_sum\")"],"type":"math"},{"params":["Mean"],"type":"alias"}],[{"params":["shared_blks_hit_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Hit"],"type":"alias"}],[{"params":["shared_blks_read_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Read"],"type":"alias"}]],"tags":[{"key":"usename","operator":"=~","value":"/^$usename$/"}]}],"transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Calls":6,"Mean":8,"Rows":7,"Shared Hit":9,"Shared Read":10,"Time":0,"Total":5,"datname":2,"host":1,"queryid":4,"usename":3},"renameByName":{}}}],"transparent":true,"type":"table"},{"datasource":"$db","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false,"width":100},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"usename"},"properties":[{"id":"custom.width"}]},{"matcher":{"id":"byName","options":"Total"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":3,"w":23,"x":0,"y":4},"id":129,"links":[],"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"","targets":[{"groupBy":[{"params":["host"],"type":"tag"},{"params":["datname"],"type":"tag"},{"params":["usename"],"type":"tag"},{"params":["queryid"],"type":"tag"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","query":"","rawQuery":false,"refId":"A","resultFormat":"table","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Calls"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Total"],"type":"alias"}],[{"params":["rows_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Rows"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / sum(\"calls_sum\")"],"type":"math"},{"params":["Mean"],"type":"alias"}],[{"params":["shared_blks_hit_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Hit"],"type":"alias"}],[{"params":["shared_blks_read_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Read"],"type":"alias"}]],"tags":[{"key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Calls":6,"Mean":8,"Rows":7,"Shared Hit":9,"Shared Read":10,"Time":0,"Total":5,"datname":2,"host":1,"queryid":4,"usename":3},"renameByName":{}}}],"transparent":true,"type":"table"},{"datasource":"$db","fieldConfig":{"defaults":{"custom":{"align":null,"filterable":false,"width":100},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"usename"},"properties":[{"id":"custom.width"}]},{"matcher":{"id":"byName","options":"Total"},"properties":[{"id":"custom.width","value":null}]}]},"gridPos":{"h":4,"w":23,"x":0,"y":7},"id":130,"links":[],"options":{"showHeader":true,"sortBy":[]},"pluginVersion":"","targets":[{"groupBy":[{"params":["host"],"type":"tag"},{"params":["datname"],"type":"tag"},{"params":["usename"],"type":"tag"},{"params":["query_md5"],"type":"tag"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","query":"","rawQuery":false,"refId":"A","resultFormat":"table","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Calls"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Total"],"type":"alias"}],[{"params":["rows_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Rows"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / sum(\"calls_sum\")"],"type":"math"},{"params":["Mean"],"type":"alias"}],[{"params":["shared_blks_hit_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Hit"],"type":"alias"}],[{"params":["shared_blks_read_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Shared Read"],"type":"alias"}]],"tags":[{"key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"transformations":[{"id":"organize","options":{"excludeByName":{"Time":true},"indexByName":{"Calls":6,"Mean":8,"Rows":7,"Shared Hit":9,"Shared Read":10,"Time":0,"Total":5,"datname":2,"host":1,"query_md5":4,"usename":3},"renameByName":{}}}],"transparent":true,"type":"table"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":0,"y":11},"hiddenSeries":false,"id":66,"interval":"10m","legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":200,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"alias":"($tag_host) $tag_query_md5","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"A","resultFormat":"time_series","select":[[{"params":["duration_10m"],"type":"field"},{"params":[],"type":"sum"},{"params":["/($__interval_ms / 1000 / 60)"],"type":"math"}]],"tags":[{"key":"queryid","operator":"=~","value":"/^$queryid$/"},{"condition":"AND","key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]},{"alias":"($tag_host) $tag_query_md5","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/($__interval_ms / 1000 / 60)"],"type":"math"}]],"tags":[{"key":"queryid","operator":"=~","value":"/^$queryid$/"},{"condition":"AND","key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Sum: Query Duration / min","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":6,"gridPos":{"h":5,"w":9,"x":7,"y":11},"hiddenSeries":false,"id":67,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":1,"maxDataPoints":100,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:473","alias":"Sum Duration per minute by Query / Sum Duration per minute by DB","color":"#336699"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Sum Duration per minute by Query","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","query":"SELECT sum(\"duration_10m\") as \"Sum Duration per minute by Query\" FROM \"$archive\".\"pg_stat_statements_query_md5\" WHERE (\"datname\" =~ /^$datname$/ AND \"host\" =~ /^$host$/ AND \"usename\" =~ /^$usename$/ AND \"queryid\" =~ /^$queryid$/ AND \"query_md5\" =~ /^$query_md5$/) AND $timeFilter GROUP BY time($__interval), \"query_md5\" fill(null)","rawQuery":false,"refId":"C","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Sum Duration per minute by Query"],"type":"alias"}]],"tags":[{"key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"},{"condition":"AND","key":"datname","operator":"=~","value":"/^$datname$/"}]},{"alias":"Sum Duration per minute by DB","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","query":"SELECT sum(\"duration_10m\") as \"Sum Duration per minute by DB\" FROM \"$archive\".\"pg_stat_statements_query_md5\" WHERE (\"datname\" =~ /^$datname$/ AND \"host\" =~ /^$host$/ AND \"usename\" =~ /^$usename$/) AND $timeFilter GROUP BY time($__interval), \"query_md5\" fill(null)","rawQuery":false,"refId":"D","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["Sum Duration per minute by DB"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query duration / DB duration","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[{"id":"calculateField","options":{"binary":{"left":"Sum Duration per minute by Query","operator":"/","reducer":"sum","right":"Sum Duration per minute by DB"},"mode":"binary","reduce":{"reducer":"sum"},"replaceFields":true}}],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":null,"format":"percentunit","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":16,"y":11},"hiddenSeries":false,"id":68,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"A","resultFormat":"time_series","select":[[{"params":["duration_10m"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_10m)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg (Query Duration)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"Средняя интенсивность вызовов запроса.\nИзмеряется в запросах в сек (RPS)","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":0,"y":16},"hiddenSeries":false,"id":69,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":200,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:9603","alias":"RPS","color":"#FF9830"}],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"alias":"($tag_host) $tag_query_md5","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"A","resultFormat":"time_series","select":[[{"params":["calls_10m"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"($tag_host) $tag_query_md5","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Calls","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"reqps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":9,"x":7,"y":16},"hiddenSeries":false,"id":79,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":3,"maxDataPoints":100,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"$$hashKey":"object:9465","alias":"RPS Query / RPS DB","color":"#FF9830"}],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"alias":"RPS Query","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"A","resultFormat":"time_series","select":[[{"params":["calls_10m"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"RPS DB","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["calls_10m"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]},{"alias":"RPS Query","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"C","resultFormat":"time_series","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"RPS DB","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"D","resultFormat":"time_series","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Calls / DB Calls","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[{"id":"calculateField","options":{"alias":"","binary":{"left":"RPS Query","operator":"/","reducer":"sum","right":"RPS DB"},"mode":"binary","reduce":{"reducer":"sum"},"replaceFields":true}}],"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"percentunit","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":16,"y":16},"hiddenSeries":false,"id":80,"interval":"10m","legend":{"avg":false,"current":false,"hideEmpty":true,"hideZero":true,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"hide":true,"measurement":"pg_stat_statements_query_md5","orderByTime":"ASC","policy":"$archive","refId":"A","resultFormat":"time_series","select":[[{"params":["rows_10m"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_10m)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["rows_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg (Query Rows)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":0,"format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":0,"y":21},"hiddenSeries":false,"id":131,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:380","alias":"Sum duration by 1min","color":"#73BF69","fill":0,"fillGradient":0,"nullPointMode":"null"},{"$$hashKey":"object:1875","alias":"Duration+","color":"#73BF69","fillBelowTo":"Avg","lines":false},{"$$hashKey":"object:1880","alias":"Avg","color":"#5794F2","fillBelowTo":"Duration-","hideTooltip":true,"lines":false},{"$$hashKey":"object:1891","alias":"Duration-","hideTooltip":false,"lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"mean"},{"params":[" /($__interval_ms / 1000 / 60) + mean(duration_stddev)"],"type":"math"},{"params":["Duration+"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"mean"},{"params":["/($__interval_ms / 1000 / 60)"],"type":"math"},{"params":["Avg"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"mean"},{"params":[" /($__interval_ms / 1000 / 60) - mean(duration_stddev)"],"type":"math"},{"params":["Duration-"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"mean"},{"params":["/($__interval_ms / 1000 / 60)"],"type":"math"},{"params":["Sum duration by 1min"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Sum: Query Duration / min with Std Dev","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"transformations":[],"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"Средняя интенсивность вызовов запроса.\nИзмеряется в запросах в сек (RPS)","fieldConfig":{"defaults":{},"overrides":[]},"fill":0,"fillGradient":0,"gridPos":{"h":5,"w":9,"x":7,"y":21},"hiddenSeries":false,"id":132,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":200,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:1341","alias":"RPS","color":"#73BF69","fill":0},{"$$hashKey":"object:1346","alias":"+StdDev","fillBelowTo":"Avg","lines":false},{"$$hashKey":"object:1351","alias":"Avg","fillBelowTo":"-StdDev","lines":false},{"$$hashKey":"object:1362","alias":"-StdDev","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000) + mean(calls_stddev)/60"],"type":"math"},{"params":["+StdDev"],"type":"alias"}],[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000)"],"type":"math"},{"params":["Avg"],"type":"alias"}],[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000) - mean(calls_stddev)/60"],"type":"math"},{"params":["-StdDev"],"type":"alias"}],[{"params":["calls_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000)"],"type":"math"},{"params":["RPS"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Calls","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"reqps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"Среднее значение для всех хостов, баз данных, текстов запроса. Для данного queryid","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":5,"w":7,"x":16,"y":21},"hiddenSeries":false,"id":133,"interval":"10m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:638","alias":"Duration","fill":0,"lines":true},{"$$hashKey":"object:645","alias":"Duration+","fillBelowTo":"Avg","lines":false},{"$$hashKey":"object:650","alias":"Avg","fillBelowTo":"Duration-","lines":false},{"$$hashKey":"object:661","alias":"Duration-","lines":false}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$col","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_query_md5_10min","orderByTime":"ASC","policy":"$archive","refId":"B","resultFormat":"time_series","select":[[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum) + mean(duration_stddev)/sum(calls_sum)"],"type":"math"},{"params":["Duration+"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum)"],"type":"math"},{"params":["Avg"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum) - mean(duration_stddev)/sum(calls_sum)"],"type":"math"},{"params":["Duration-"],"type":"alias"}],[{"params":["duration_sum"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls_sum)"],"type":"math"},{"params":["Duration"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"},{"condition":"AND","key":"host","operator":"=~","value":"/^$host$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg (Query Duration)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"columns":[],"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fontSize":"100%","gridPos":{"h":15,"w":24,"x":0,"y":26},"id":46,"links":[],"pageSize":1,"repeat":"query_md5","scopedVars":{"query_md5":{"selected":false,"text":"d4300958-580a-b6d2-7900-24b7e64f4635","value":"d4300958-580a-b6d2-7900-24b7e64f4635"}},"scroll":true,"showHeader":true,"sort":{"col":6,"desc":true},"styles":[{"$$hashKey":"object:1593","alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"Time","thresholds":[],"type":"hidden","unit":"short"},{"$$hashKey":"object:1613","alias":"","align":"auto","colorMode":null,"colors":["rgba(245, 54, 54, 0.9)","rgba(237, 129, 40, 0.89)","rgba(50, 172, 45, 0.97)"],"dateFormat":"YYYY-MM-DD HH:mm:ss","decimals":2,"mappingType":1,"pattern":"last","thresholds":[],"type":"hidden","unit":"short"}],"targets":[{"groupBy":[{"params":["query"],"type":"tag"}],"hide":false,"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$archive","query":"SELECT last(\"calls_sum\") as \"calls\" FROM \"$archive\".\"pg_stat_statements_diff_1d\" WHERE (\"query_md5\" =~ /^$query_md5$/ AND \"queryid\" =~ /^$queryid$/ AND \"datname\" =~ /^$datname$/) GROUP BY \"query\"","rawQuery":true,"refId":"D","resultFormat":"table","select":[[{"params":["calls"],"type":"field"},{"params":[],"type":"last"}]],"tags":[{"key":"query_md5","operator":"=~","value":"/^$query_md5$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"},{"condition":"AND","key":"host","operator":"=~","value":"/^$host$/"},{"condition":"AND","key":"datname","operator":"=~","value":"/^$datname$/"}]},{"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"orderByTime":"ASC","policy":"default","query":"SELECT last(\"calls\") as \"calls\" FROM \"$new\".\"pg_stat_statements\" WHERE (\"query_md5\" =~ /^$query_md5$/ AND \"queryid\" =~ /^$queryid$/ AND \"datname\" =~ /^$datname$/) GROUP BY \"query\"","rawQuery":true,"refId":"A","resultFormat":"table","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]}],"title":"Query Text of $query_md5","transform":"table","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"calls":true},"indexByName":{"Calls":7,"Max":9,"Mean":10,"Rows":8,"Time":0,"Total":6,"datname":1,"query":5,"query_md5":4,"queryid":3,"usename":2},"renameByName":{}}}],"type":"table-old"},{"collapsed":false,"datasource":null,"gridPos":{"h":1,"w":24,"x":0,"y":41},"id":92,"panels":[],"title":"Детальная статистика по QueryID = ${queryid} (есть данные только за последние 7 дней)","type":"row"},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":0,"y":42},"hiddenSeries":false,"id":94,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["duration"],"type":"field"},{"params":[],"type":"sum"},{"params":["/($__interval_ms / 1000 / 60)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Sum: Query Duration / min","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":6,"gridPos":{"h":5,"w":9,"x":7,"y":42},"hiddenSeries":false,"id":96,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":1,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:473","alias":"Sum Duration per minute by Query / Sum Duration per minute by DB","color":"#336699"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"Sum Duration per minute by Query","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","query":"SELECT sum(\"duration_10m\") as \"Sum Duration per minute by Query\" FROM \"$archive\".\"pg_stat_statements_query_md5\" WHERE (\"datname\" =~ /^$datname$/ AND \"host\" =~ /^$host$/ AND \"usename\" =~ /^$usename$/ AND \"queryid\" =~ /^$queryid$/ AND \"query_md5\" =~ /^$query_md5$/) AND $timeFilter GROUP BY time($__interval), \"query_md5\" fill(null)","rawQuery":false,"refId":"A","resultFormat":"time_series","select":[[{"params":["duration"],"type":"field"},{"params":[],"type":"sum"},{"params":["Sum Duration per minute by Query"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"Sum Duration per minute by DB","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","query":"SELECT sum(\"duration_10m\") as \"Sum Duration per minute by DB\" FROM \"$archive\".\"pg_stat_statements_query_md5\" WHERE (\"datname\" =~ /^$datname$/ AND \"host\" =~ /^$host$/ AND \"usename\" =~ /^$usename$/) AND $timeFilter GROUP BY time($__interval), \"query_md5\" fill(null)","rawQuery":false,"refId":"B","resultFormat":"time_series","select":[[{"params":["duration"],"type":"field"},{"params":[],"type":"sum"},{"params":["Sum Duration per minute by DB"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query duration / DB duration","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[{"id":"calculateField","options":{"binary":{"left":"Sum Duration per minute by Query","operator":"/","reducer":"sum","right":"Sum Duration per minute by DB"},"mode":"binary","reduce":{"reducer":"sum"},"replaceFields":true}}],"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":null,"format":"percentunit","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":16,"y":42},"hiddenSeries":false,"id":98,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_query_md5","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["duration"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg (Query Duration)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":1,"format":"ms","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"Средняя интенсивность вызовов запроса за минуту.\nИзмеряется в запросах в сек (RPS)","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":0,"y":47},"hiddenSeries":false,"id":100,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:9603","alias":"RPS","color":"#FF9830"}],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["calls"],"type":"field"},{"params":[],"type":"sum"},{"params":[" / ($__interval_ms / 1000)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Calls","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"reqps","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":9,"x":7,"y":47},"hiddenSeries":false,"id":102,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","repeat":null,"seriesOverrides":[{"$$hashKey":"object:9465","alias":"RPS Query / RPS DB","color":"#FF9830"}],"spaceLength":10,"stack":false,"steppedLine":true,"targets":[{"alias":"RPS Query","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["calls"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]},{"alias":"RPS DB","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"B","resultFormat":"time_series","select":[[{"params":["calls"],"type":"field"},{"params":[],"type":"sum"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Query Calls / DB Calls","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"transformations":[{"id":"calculateField","options":{"alias":"","binary":{"left":"RPS Query","operator":"/","reducer":"sum","right":"RPS DB"},"mode":"binary","reduce":{"reducer":"sum"},"replaceFields":true}}],"transparent":true,"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"percentunit","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":7,"x":16,"y":47},"hiddenSeries":false,"id":104,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:732","alias":"/.*/"}],"spaceLength":10,"stack":false,"steppedLine":false,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["rows"],"type":"field"},{"params":[],"type":"sum"},{"params":["/sum(calls)"],"type":"math"},{"params":["Avg"],"type":"alias"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Avg (Query Rows)","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","decimals":0,"format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":6,"x":0,"y":52},"hiddenSeries":false,"id":115,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["shared_blks_hit"],"type":"field"},{"params":[],"type":"sum"},{"params":[" /sum(calls)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Shared Blk Hit","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":6,"x":6,"y":52},"hiddenSeries":false,"id":116,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["shared_blks_read"],"type":"field"},{"params":[],"type":"sum"},{"params":[" /sum(calls)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Shared Blk Read","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":6,"x":12,"y":52},"hiddenSeries":false,"id":117,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["shared_blks_dirtied"],"type":"field"},{"params":[],"type":"sum"},{"params":[" /sum(calls)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Shared Blk Dirtied","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}},{"aliasColors":{},"bars":false,"dashLength":10,"dashes":false,"datasource":"$db","description":"","fieldConfig":{"defaults":{},"overrides":[]},"fill":1,"fillGradient":10,"gridPos":{"h":5,"w":6,"x":18,"y":52},"hiddenSeries":false,"id":118,"interval":"1m","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":true,"linewidth":3,"maxDataPoints":1000,"nullPointMode":"null","options":{"alertThreshold":true},"percentage":false,"pluginVersion":"","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[],"spaceLength":10,"stack":true,"steppedLine":true,"targets":[{"alias":"$tag_query_md5 ($tag_host)","groupBy":[{"params":["$__interval"],"type":"time"},{"params":["query_md5"],"type":"tag"},{"params":["host"],"type":"tag"},{"params":["null"],"type":"fill"}],"measurement":"pg_stat_statements_diff","orderByTime":"ASC","policy":"$new","refId":"A","resultFormat":"time_series","select":[[{"params":["shared_blks_written"],"type":"field"},{"params":[],"type":"sum"},{"params":[" /sum(calls)"],"type":"math"}]],"tags":[{"key":"datname","operator":"=~","value":"/^$datname$/"},{"condition":"AND","key":"usename","operator":"=~","value":"/^$usename$/"},{"condition":"AND","key":"queryid","operator":"=~","value":"/^$queryid$/"}]}],"thresholds":[],"timeFrom":null,"timeRegions":[],"timeShift":null,"title":"Shared Blk Writen","tooltip":{"shared":true,"sort":0,"value_type":"individual"},"type":"graph","xaxis":{"buckets":null,"mode":"time","name":null,"show":true,"values":[]},"yaxes":[{"$$hashKey":"object:4547","format":"none","label":null,"logBase":1,"max":null,"min":"0","show":true},{"$$hashKey":"object:4548","format":"short","label":null,"logBase":1,"max":null,"min":null,"show":true}],"yaxis":{"align":false,"alignLevel":null}}],"refresh":false,"schemaVersion":27,"style":"dark","tags":["influxdb","PostgreSQL"],"templating":{"list":[{"current":{"selected":false,"text":"Influx-production-1","value":"Influx-production-1"},"description":null,"error":null,"hide":2,"includeAll":false,"label":"DataBase for annotation","multi":false,"name":"db_jmeter","options":[],"query":"influxdb","queryValue":"","refresh":1,"regex":"/^Stand-.*-JMeter$/i","skipUrlSync":false,"type":"datasource"},{"current":{"selected":false,"text":"PostgreSQL Query: Stand-Demo-JMeter","value":"PostgreSQL Query: Stand-Demo-JMeter"},"description":null,"error":null,"hide":2,"includeAll":false,"label":"DataBase","multi":false,"name":"db","options":[],"query":"influxdb","refresh":1,"regex":"/PostgreSQL Query: ${db_jmeter:regex}/i","skipUrlSync":false,"type":"datasource"},{"allValue":null,"current":{"selected":false,"text":"autogen","value":"autogen"},"datasource":"$db","definition":"","description":null,"error":null,"hide":2,"includeAll":false,"label":"Retention policy (archive)","multi":false,"name":"archive","options":[],"query":"SHOW RETENTION POLICIES","refresh":2,"regex":"/^autogen$/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"7d","value":"7d"},"datasource":"$db","definition":"","description":null,"error":null,"hide":2,"includeAll":false,"label":"Retention Policy (new)","multi":false,"name":"new","options":[],"query":"SHOW RETENTION POLICIES","refresh":2,"regex":"/^(?!$archive$).*$/","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"current":{"selected":false,"text":"3889201485","value":"3889201485"},"description":null,"error":null,"hide":0,"label":"queryid","name":"queryid","options":[{"selected":false,"text":"3889201485","value":"3889201485"}],"query":"3889201485","skipUrlSync":false,"type":"textbox"},{"allValue":"","current":{"selected":false,"text":"${__data.fields[host]}","value":["${__data.fields[host]}"]},"datasource":"$db","definition":"SELECT DISTINCT(\"host\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"queryid\"=~/^${queryid:regex}$/ AND $timeFilter GROUP BY \"host\")","description":null,"error":null,"hide":0,"includeAll":true,"label":"PostgreSQL host","multi":true,"name":"host","options":[],"query":"SELECT DISTINCT(\"host\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"queryid\"=~/^${queryid:regex}$/ AND $timeFilter GROUP BY \"host\")","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":"","current":{"selected":false,"text":"demo","value":["demo"]},"datasource":"$db","definition":"SELECT DISTINCT(\"datname\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"queryid\"=~/^${queryid:regex}$/ AND \"host\" =~ /^${host:regex}$/ AND $timeFilter GROUP BY \"datname\")","description":null,"error":null,"hide":2,"includeAll":true,"label":"PostgreSQL DB","multi":true,"name":"datname","options":[],"query":"SELECT DISTINCT(\"datname\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"queryid\"=~/^${queryid:regex}$/ AND \"host\" =~ /^${host:regex}$/ AND $timeFilter GROUP BY \"datname\")","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{"selected":false,"text":"rrko_async_ms","value":["rrko_async_ms"]},"datasource":"$db","definition":"SELECT DISTINCT(\"usename\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE $timeFilter AND \"queryid\"=~/^${queryid:regex}$/ AND \"datname\" =~ /^${datname:regex}$/ AND \"host\" =~ /^${host:regex}$/  GROUP BY \"usename\")","description":null,"error":null,"hide":0,"includeAll":true,"label":"PostgreSQL User","multi":true,"name":"usename","options":[],"query":"SELECT DISTINCT(\"usename\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE $timeFilter AND \"queryid\"=~/^${queryid:regex}$/ AND \"datname\" =~ /^${datname:regex}$/ AND \"host\" =~ /^${host:regex}$/  GROUP BY \"usename\")","refresh":2,"regex":"","skipUrlSync":false,"sort":1,"tagValuesQuery":"SELECT DISTINCT(\"usename\") FROM (SELECT last(\"calls\") FROM \"$new\".\"pg_stat_statements\" WHERE \"datname\" =~ /^${tag:regex}$/  AND \"host\" =~ /^${host:regex}$/ GROUP BY \"usename\")","tags":[{"text":"name"}],"tagsQuery":"SELECT DISTINCT(\"datname\") FROM (SELECT last(\"calls\") FROM \"$new\".\"pg_stat_statements\" WHERE \"datname\" =~ /^${datname:regex}$/  AND \"host\" =~ /^${host:regex}$/ GROUP BY \"datname\")","type":"query","useTags":false},{"allValue":null,"current":{"selected":false,"text":"All","value":"$__all"},"datasource":"$db","definition":"SELECT DISTINCT(\"query_md5\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"datname\" =~ /^${datname:regex}$/ AND \"queryid\" =~ /^${queryid:regex}$/  AND $timeFilter GROUP BY \"query_md5\")","description":null,"error":null,"hide":0,"includeAll":true,"label":null,"multi":true,"name":"query_md5","options":[],"query":"SELECT DISTINCT(\"query_md5\") FROM (SELECT last(\"calls_sum\") FROM \"${archive}\".\"pg_stat_statements_query_md5_10min\" WHERE \"datname\" =~ /^${datname:regex}$/ AND \"queryid\" =~ /^${queryid:regex}$/  AND $timeFilter GROUP BY \"query_md5\")","refresh":2,"regex":"","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tags":[],"tagsQuery":"","type":"query","useTags":false}]},"time":{"from":"2020-11-11T12:24:09.228Z","to":"2020-11-11T13:13:06.986Z"},"timepicker":{"refresh_intervals":["10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"PostgreSQL Query Details","uid":"pgquery","version":16}}